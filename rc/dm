#!/bin/rc

# Create/list/attach/detach applications using dtach

flag e+

sockdir=/tmp/dm
keyseq=

fn list {
    find $sockdir -type s
    exit 0
}

test -d $sockdir || mkdir -p $sockdir

if (~ $1 -l || ~ $1 -h) {
	switch($1) {
		case -l 
			list
		case -h 
    		printf 'dm [-hl] <alias> [command]\n'
    		exit 0
	}
}

switch($#*) {
	case 0 
		list
	case 1 
		method=a
	case * 
		method=A
}

name=$1
shift

socket=$sockdir/$name

dtach -$method $socket -e $keyseq -r winch $*
